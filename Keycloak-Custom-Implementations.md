# Forgot-Password Feature UserFederationProvider-KeyCloak

- Make a custom Authentication provider mimicking the flow of the 'reset-credential-email' authenticator and instead of calling the EmailProvider in the authenticate method of the authenticator call UserProvider's service to initiate the email process.

- In the Authentication Flows of the admin console make a copy of the reset credentials flow and keep only two executions i.e. Choose User and your custom authenticator in my case 'abc-reset-password-email'.

- To expose a Rest Endpoint in KeyCloak make a custom implementation of RealmResourceProviderFactory and RealmResourceProvider.

- In the provider class expose rest endpoints.

- The URL will be relative to the realm and the provider-id,i.e. : {base-url}/auth/realms/{realm-id}/{provider-id}/{custom-endpoint}

- For example: localhost:8082/auth/realms/master/verify-registration/user/update-password

- Make an endpoint for the link in the email.

- On clicking the link it should redirect to the reset-password form of keycloak which is generated by the FreeMarkerLoginFormsProvider class in the rest endpoint.

- The reset-password form will have action url specified which will be a second rest endpoint created in the custom realm resource provider class.

- The rest-endpoint will take formdata as requestbody and after validating that password and confirm-password are same it will create a ResetPassword model object (password and token) and call the UserProvider's service to reset the password.

- The response from the UserProvider's service is shown on a redirected custom page with the link to the respective theme's home page.
